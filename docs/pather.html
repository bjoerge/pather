<!DOCTYPE html>  <html> <head>   <title>pather.js</title>   <meta http-equiv="content-type" content="text/html; charset=UTF-8">   <link rel="stylesheet" media="all" href="docco.css" /> </head> <body>   <div id="container">     <div id="background"></div>          <table cellpadding="0" cellspacing="0">       <thead>         <tr>           <th class="docs">             <h1>               pather.js             </h1>           </th>           <th class="code">           </th>         </tr>       </thead>       <tbody>                               <tr id="section-1">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-1">&#182;</a>               </div>                            </td>             <td class="code">               <div class="highlight"><pre><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">root</span><span class="p">,</span> <span class="nx">win</span><span class="p">)</span> <span class="p">{</span>
  <span class="s2">&quot;use strict&quot;</span><span class="p">;</span>
  <span class="kd">var</span></pre></div>             </td>           </tr>                               <tr id="section-2">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-2">&#182;</a>               </div>               <p>A few patterns recklessly stolen from Backbone.js and modified a little</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">namedParam</span> <span class="o">=</span> <span class="sr">/:\w+/g</span><span class="p">,</span>
    <span class="nx">splatParam</span> <span class="o">=</span> <span class="sr">/\*\w+/g</span><span class="p">,</span>
    <span class="nx">subPath</span> <span class="o">=</span> <span class="sr">/\*/g</span><span class="p">,</span>
    <span class="nx">escapeRegExp</span> <span class="o">=</span> <span class="sr">/[-[\]{}()+?.,\\^$|#\s]/g</span><span class="p">,</span></pre></div>             </td>           </tr>                               <tr id="section-3">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-3">&#182;</a>               </div>               <p>Convert a route string to a regular expression</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">routeToRegExp</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">parts</span> <span class="o">=</span> <span class="nx">route</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s2">&quot;?&quot;</span><span class="p">),</span>
          <span class="nx">path</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> 
          <span class="nx">search</span> <span class="o">=</span> <span class="nx">parts</span><span class="p">[</span><span class="mi">1</span><span class="p">];</span>
      
      <span class="nx">route</span> <span class="o">=</span> <span class="nx">path</span>
              <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">escapeRegExp</span><span class="p">,</span> <span class="s2">&quot;\\$&amp;&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">namedParam</span><span class="p">,</span> <span class="s2">&quot;([^/]+)&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">splatParam</span><span class="p">,</span> <span class="s2">&quot;(.*)?&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">subPath</span><span class="p">,</span> <span class="s2">&quot;.*?&quot;</span><span class="p">)</span>
              <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/?$/</span><span class="p">,</span> <span class="s2">&quot;/?&quot;</span><span class="p">);</span>

      <span class="k">if</span> <span class="p">(</span><span class="nx">search</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">search</span> <span class="o">=</span> <span class="nx">search</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">escapeRegExp</span><span class="p">,</span> <span class="s2">&quot;\\$&amp;&quot;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">namedParam</span><span class="p">,</span> <span class="s2">&quot;([^/]+)&quot;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">splatParam</span><span class="p">,</span> <span class="s2">&quot;(.*)?&quot;</span><span class="p">)</span>
          <span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="nx">subPath</span><span class="p">,</span> <span class="s2">&quot;.*?&quot;</span><span class="p">);</span>
                <span class="nx">route</span> <span class="o">=</span> <span class="nx">route</span><span class="o">+</span><span class="s2">&quot;\\?&quot;</span><span class="o">+</span><span class="nx">search</span><span class="p">;</span>
      <span class="p">}</span>
      
      <span class="k">return</span> <span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span> <span class="o">+</span> <span class="nx">route</span> <span class="o">+</span> <span class="s2">&quot;$&quot;</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-4">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-4">&#182;</a>               </div>               <p>Cross browser addEventListener</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">addDOMListener</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">addDOMListener</span> <span class="o">=</span> <span class="nb">window</span><span class="p">[</span><span class="nb">window</span><span class="p">.</span><span class="nx">addEventListener</span> <span class="o">?</span> <span class="s1">&#39;addEventListener&#39;</span> <span class="o">:</span> <span class="s1">&#39;attachEvent&#39;</span><span class="p">].</span><span class="nx">bind</span><span class="p">(</span><span class="nb">window</span><span class="p">);</span>
      <span class="k">return</span> <span class="nx">addDOMListener</span><span class="p">(</span><span class="nx">type</span><span class="p">,</span> <span class="nx">listener</span><span class="p">,</span> <span class="nx">useCapture</span><span class="p">);</span>
    <span class="p">},</span></pre></div>             </td>           </tr>                               <tr id="section-5">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-5">&#182;</a>               </div>               <p>Compare two objects recursively for equality
Note that this a rather naive deepEqual implementation.
It should, however be sufficient as only strings are extracted as parameters from the pathname
This is derived from github.com/substack/node-deep-equal, which again is derived from the Node.js source code</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="nx">deepEqual</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">object</span><span class="p">,</span> <span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">object</span> <span class="o">===</span> <span class="nx">other</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">object</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span> <span class="o">&amp;&amp;</span> <span class="k">typeof</span> <span class="nx">other</span> <span class="o">!==</span> <span class="s1">&#39;object&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-6">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-6">&#182;</a>               </div>               <p>We are dealing with two primitives</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">return</span> <span class="nx">object</span> <span class="o">==</span> <span class="nx">other</span><span class="p">;</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="kd">var</span> <span class="nx">keysActual</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">object</span><span class="p">),</span>
          <span class="nx">keysExpected</span> <span class="o">=</span> <span class="nb">Object</span><span class="p">.</span><span class="nx">getOwnPropertyNames</span><span class="p">(</span><span class="nx">other</span><span class="p">),</span>
          <span class="nx">i</span><span class="p">;</span>

        <span class="k">if</span> <span class="p">(</span><span class="nx">keysActual</span><span class="p">.</span><span class="nx">length</span> <span class="o">!=</span> <span class="nx">keysExpected</span><span class="p">.</span><span class="nx">length</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-7">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-7">&#182;</a>               </div>               <p>Make sure we compare the set of keys in the same order</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="nx">keysActual</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span>
        <span class="nx">keysExpected</span><span class="p">.</span><span class="nx">sort</span><span class="p">();</span></pre></div>             </td>           </tr>                               <tr id="section-8">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-8">&#182;</a>               </div>               <p>Quickly compare keys</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">keysActual</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
          <span class="k">if</span> <span class="p">(</span><span class="nx">keysActual</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">!=</span> <span class="nx">keysExpected</span><span class="p">[</span><span class="nx">i</span><span class="p">])</span>
            <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">for</span> <span class="p">(</span><span class="nx">i</span> <span class="o">=</span> <span class="nx">keysActual</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
          <span class="kd">var</span> <span class="nx">key</span> <span class="o">=</span> <span class="nx">keysActual</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
          <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="nx">deepEqual</span><span class="p">(</span><span class="nx">object</span><span class="p">[</span><span class="nx">key</span><span class="p">],</span> <span class="nx">other</span><span class="p">[</span><span class="nx">key</span><span class="p">]))</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
        <span class="p">}</span>
        <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-9">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-9">&#182;</a>               </div>               <p>PatherEventListener constructor
Takes three parameters:</p>

<ul>
<li><code>route</code> which is a RouteString or a Regex with captures</li>
<li><code>event</code> and is optional and can be either <code>enter</code> (default) or <code>leave</code></li>
<li><code>eventHandler</code> is the function to receive a call whenever a change matching the event type occurs</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="kd">function</span> <span class="nx">PatherEventListener</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">PatherEventListener</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">PatherEventListener</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">type</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">this</span><span class="p">.</span><span class="nx">route</span> <span class="o">=</span> <span class="nx">route</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-10">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-10">&#182;</a>               </div>               <p>The 'enter' event type is default for route matching and used if third argument is omitted</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">eventHandler</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="s1">&#39;enter&#39;</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eventHandler</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">event</span> <span class="o">=</span> <span class="nx">type</span><span class="p">;</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">eventHandler</span> <span class="o">=</span> <span class="nx">eventHandler</span><span class="p">;</span>
    <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-11">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-11">&#182;</a>               </div>               <p>The route string are compiled to a regexp (if it isn't already)</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">regexp</span> <span class="o">=</span> <span class="p">(</span><span class="nx">route</span> <span class="k">instanceof</span> <span class="nb">RegExp</span><span class="p">)</span> <span class="o">?</span> <span class="nx">route</span> <span class="o">:</span> <span class="nx">routeToRegExp</span><span class="p">(</span><span class="nx">route</span><span class="p">);</span></pre></div>             </td>           </tr>                               <tr id="section-12">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-12">&#182;</a>               </div>               <p>This indicates whether the listener should be removed after firing the first time or keep on firing
whenever it becomes active</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-13">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-13">&#182;</a>               </div>               <p>Indicates whether the current listener is active</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span></pre></div>             </td>           </tr>                               <tr id="section-14">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-14">&#182;</a>               </div>               <p>Store the extracted parameters from the current pathname</p>             </td>             <td class="code">               <div class="highlight"><pre>    <span class="k">this</span><span class="p">.</span><span class="nx">previousParams</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">}</span>

  <span class="kd">function</span> <span class="nx">Pather</span><span class="p">(</span><span class="nx">options</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="k">this</span> <span class="k">instanceof</span> <span class="nx">Pather</span><span class="p">))</span> <span class="p">{</span>
      <span class="k">return</span> <span class="k">new</span> <span class="nx">Pather</span><span class="p">(</span><span class="nx">options</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">options</span> <span class="o">=</span> <span class="nx">options</span> <span class="o">||</span> <span class="p">(</span><span class="nx">options</span> <span class="o">=</span> <span class="p">{});</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="p">[];</span>

    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;pushState&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">pushState</span> <span class="o">===</span> <span class="kc">false</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">addDOMListener</span><span class="p">(</span><span class="s1">&#39;popstate&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_checkAll</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">options</span><span class="p">.</span><span class="nx">hasOwnProperty</span><span class="p">(</span><span class="s1">&#39;hash&#39;</span><span class="p">)</span> <span class="o">||</span> <span class="nx">options</span><span class="p">.</span><span class="nx">hash</span> <span class="o">===</span> <span class="kc">false</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">addDOMListener</span><span class="p">(</span><span class="s1">&#39;hashchange&#39;</span><span class="p">,</span> <span class="k">this</span><span class="p">.</span><span class="nx">_checkAll</span><span class="p">.</span><span class="nx">bind</span><span class="p">(</span><span class="k">this</span><span class="p">));</span>
    <span class="p">}</span>
  <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-15">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-15">&#182;</a>               </div>               <p><code>_normalizeRoute</code> normalizes a route according to configured root path</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_normalizeRoute</span> <span class="o">=</span> <span class="kd">function</span><span class="p">(</span><span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">root</span> <span class="o">=</span> <span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">options</span><span class="p">.</span><span class="nx">root</span><span class="o">||</span><span class="s1">&#39;&#39;</span><span class="p">).</span><span class="nx">replace</span><span class="p">(</span><span class="sr">/\/?$/</span><span class="p">,</span> <span class="s2">&quot;/?&quot;</span><span class="p">);</span>
    <span class="k">return</span> <span class="nx">route</span><span class="p">.</span><span class="nx">replace</span><span class="p">(</span><span class="k">new</span> <span class="nb">RegExp</span><span class="p">(</span><span class="s2">&quot;^&quot;</span><span class="o">+</span><span class="nx">root</span><span class="p">),</span> <span class="s2">&quot;/&quot;</span><span class="p">);</span>
  <span class="p">};</span>
  </pre></div>             </td>           </tr>                               <tr id="section-16">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-16">&#182;</a>               </div>               <p><code>addListener</code> creates and adds a new listener for a given route, on a given event</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">addListener</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">addListener</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="p">(</span><span class="nx">route</span> <span class="k">instanceof</span> <span class="nb">RegExp</span><span class="p">))</span> <span class="p">{</span>
      <span class="nx">route</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_normalizeRoute</span><span class="p">(</span><span class="nx">route</span><span class="p">);</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_add</span><span class="p">(</span><span class="k">new</span> <span class="nx">PatherEventListener</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">));</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-17">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-17">&#182;</a>               </div>               <p>The <code>on</code> method is simply an alias for <code>addListener</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">on</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">on</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">addListener</span><span class="p">.</span><span class="nx">call</span><span class="p">(</span><span class="k">this</span><span class="p">,</span> <span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-18">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-18">&#182;</a>               </div>               <p><code>once</code> adds a listener that will be removed after it is triggered the first time</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">once</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">new</span> <span class="nx">PatherEventListener</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">);</span>
    <span class="nx">listener</span><span class="p">.</span><span class="nx">once</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_add</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-19">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-19">&#182;</a>               </div>               <p><code>removeListener</code> removes a listener for a given route, on a given event for a given eventHandler
Note that a reference to the original event handler must be passed as third parameter (or second if event is omitted)</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeListener</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">removeListener</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">eventHandler</span> <span class="o">==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">eventHandler</span> <span class="o">=</span> <span class="nx">event</span><span class="p">;</span>
      <span class="nx">event</span> <span class="o">=</span> <span class="s1">&#39;enter&#39;</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_remove</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_find</span><span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">))</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-20">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-20">&#182;</a>               </div>               <p><code>removeAllListeners</code> removes all listeners for this instance</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">removeAllListeners</span> <span class="o">=</span> <span class="kd">function</span> <span class="nx">removeAllListeners</span><span class="p">()</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span> <span class="o">=</span> <span class="p">[];</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-21">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-21">&#182;</a>               </div>               <p><code>matches</code> is a convenience method to check if the given regex or route string matches the current
document.location.pathname
It takes either a route string or a regexp as parameter and returns <code>true</code> or <code>false</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">matches</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="cm">/* String|RegExp */</span> <span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="o">!!</span><span class="k">this</span><span class="p">.</span><span class="nx">match</span><span class="p">(</span><span class="nx">route</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-22">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-22">&#182;</a>               </div>               <p><code>match</code> matches the given regex or route string against the current document.location.pathname and return an array with the
values for each capturing parenthesis (if any). Returns null if there is no match.</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">match</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="cm">/* String|RegExp */</span> <span class="nx">route</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">regexp</span> <span class="o">=</span> <span class="p">(</span><span class="nx">route</span> <span class="k">instanceof</span> <span class="nb">RegExp</span><span class="p">)</span> <span class="o">?</span> <span class="nx">route</span> <span class="o">:</span> <span class="nx">routeToRegExp</span><span class="p">(</span><span class="nx">route</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">matches</span> <span class="o">=</span> <span class="nx">regexp</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">_getPath</span><span class="p">());</span>
    <span class="k">return</span> <span class="nx">matches</span> <span class="o">&amp;&amp;</span> <span class="nx">matches</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-23">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-23">&#182;</a>               </div>               <p><code>has</code> checks whether any of the registered listeners matches the given path</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">has</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">pathname</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">some</span><span class="p">(</span><span class="kd">function</span> <span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">return</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">regexp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">pathname</span><span class="p">);</span>
    <span class="p">},</span> <span class="k">this</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-24">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-24">&#182;</a>               </div>               <p>Used internally for adding a listener to the internal register</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_add</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="cm">/*PatherEventListener*/</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">push</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">_check</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-25">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-25">&#182;</a>               </div>               <p>Used internally for removing a listener from the internal register</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_remove</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="cm">/*PatherEventListener*/</span> <span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">idx</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">indexOf</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">idx</span> <span class="o">===</span> <span class="o">-</span><span class="mi">1</span><span class="p">)</span> <span class="k">return</span> <span class="kc">false</span><span class="p">;</span>
    <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">splice</span><span class="p">(</span><span class="nx">idx</span><span class="p">,</span> <span class="mi">1</span><span class="p">);</span>
    <span class="k">return</span> <span class="kc">true</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-26">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-26">&#182;</a>               </div>               <p>Used internally for finding a listener by <code>route</code>, <code>event</code> and <code>eventHandler</code></p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_find</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">route</span><span class="p">,</span> <span class="nx">event</span><span class="p">,</span> <span class="nx">eventHandler</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
      <span class="kd">var</span> <span class="nx">listener</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">i</span><span class="p">];</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">route</span> <span class="o">===</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">route</span> <span class="o">&amp;&amp;</span> <span class="nx">event</span> <span class="o">===</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">event</span> <span class="o">&amp;&amp;</span> <span class="nx">eventHandler</span> <span class="o">===</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">eventHandler</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">return</span> <span class="nx">listener</span><span class="p">;</span>
      <span class="p">}</span>
    <span class="p">}</span>
    <span class="k">return</span> <span class="kc">null</span><span class="p">;</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-27">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-27">&#182;</a>               </div>               <p>Used internally for getting the current path
It returns a combination of document.location.pathname and document.location.search adjusted for root path</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_getPath</span> <span class="o">=</span> <span class="kd">function</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">loc</span> <span class="o">=</span> <span class="nb">window</span><span class="p">.</span><span class="nx">location</span><span class="p">;</span>
    <span class="kd">var</span> <span class="nx">pathname</span> <span class="o">=</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">pathname</span> <span class="o">+</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">hash</span> <span class="o">+</span> <span class="nx">loc</span><span class="p">.</span><span class="nx">search</span><span class="p">;</span>
    <span class="k">return</span> <span class="k">this</span><span class="p">.</span><span class="nx">_normalizeRoute</span><span class="p">(</span><span class="nx">pathname</span> <span class="o">||</span> <span class="s2">&quot;/&quot;</span><span class="p">);</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-28">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-28">&#182;</a>               </div>               <p>Used internally for calling a listener whenever a match has occurred</p>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_call</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">listener</span><span class="p">,</span> <span class="nx">params</span><span class="p">)</span> <span class="p">{</span>
    <span class="nx">listener</span><span class="p">.</span><span class="nx">eventHandler</span><span class="p">.</span><span class="nx">apply</span><span class="p">(</span><span class="nx">listener</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">once</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_remove</span><span class="p">(</span><span class="nx">listener</span><span class="p">);</span>
    <span class="p">}</span>
  <span class="p">};</span></pre></div>             </td>           </tr>                               <tr id="section-29">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-29">&#182;</a>               </div>               <p>Used internally for checking single listeners against the current state of affairs
A listener for the <code>enter</code> event will be called only if all of the below conditions are met:</p>

<ul>
<li>It's route string or regex matches the current pathname</li>
<li>It isnt currently active</li>
<li>It's captured parameters has changes from last time it was active (todo: maybe make an option?)</li>
</ul>             </td>             <td class="code">               <div class="highlight"><pre>  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_check</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">(</span><span class="nx">listener</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">path</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">_getPath</span><span class="p">();</span>
    <span class="k">if</span> <span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">regexp</span><span class="p">.</span><span class="nx">test</span><span class="p">(</span><span class="nx">path</span><span class="p">))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-30">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-30">&#182;</a>               </div>               <p>Todo: also capture search params</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="kd">var</span> <span class="nx">params</span> <span class="o">=</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">regexp</span><span class="p">.</span><span class="nx">exec</span><span class="p">(</span><span class="nx">path</span><span class="p">).</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">event</span> <span class="o">===</span> <span class="s1">&#39;enter&#39;</span> <span class="o">&amp;&amp;</span> <span class="o">!</span><span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">active</span> <span class="o">&amp;&amp;</span> <span class="nx">deepEqual</span><span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">previousParams</span><span class="p">,</span> <span class="nx">params</span><span class="p">)))</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-31">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-31">&#182;</a>               </div>               <p>This listener wasn't active on last enter, so go ahead and notify its eventHandler</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">_call</span><span class="p">(</span><span class="nx">listener</span><span class="p">,</span> <span class="nx">params</span><span class="p">);</span>
      <span class="p">}</span></pre></div>             </td>           </tr>                               <tr id="section-32">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-32">&#182;</a>               </div>               <p>Store the result of this check until next check</p>             </td>             <td class="code">               <div class="highlight"><pre>      <span class="nx">listener</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">true</span><span class="p">;</span>
      <span class="nx">listener</span><span class="p">.</span><span class="nx">previousParams</span> <span class="o">=</span> <span class="nx">params</span><span class="p">;</span>
    <span class="p">}</span>
    <span class="k">else</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="nx">listener</span><span class="p">.</span><span class="nx">active</span> <span class="o">&amp;&amp;</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">event</span> <span class="o">===</span> <span class="s1">&#39;leave&#39;</span><span class="p">)</span> <span class="p">{</span></pre></div>             </td>           </tr>                               <tr id="section-33">             <td class="docs">               <div class="pilwrap">                 <a class="pilcrow" href="#section-33">&#182;</a>               </div>               <p>Its a listener for 'leave' and the regexp matched on last check</p>             </td>             <td class="code">               <div class="highlight"><pre>        <span class="k">this</span><span class="p">.</span><span class="nx">_call</span><span class="p">(</span><span class="nx">listener</span><span class="p">,</span> <span class="nx">listener</span><span class="p">.</span><span class="nx">previousParams</span><span class="p">);</span>
        <span class="nx">listener</span><span class="p">.</span><span class="nx">previousParams</span> <span class="o">=</span> <span class="kc">null</span><span class="p">;</span>
      <span class="p">}</span>
      <span class="nx">listener</span><span class="p">.</span><span class="nx">active</span> <span class="o">=</span> <span class="kc">false</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="nx">Pather</span><span class="p">.</span><span class="nx">prototype</span><span class="p">.</span><span class="nx">_checkAll</span> <span class="o">=</span> <span class="kd">function</span> <span class="p">()</span> <span class="p">{</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span> <span class="o">=</span> <span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">--</span><span class="p">;)</span> <span class="p">{</span>
      <span class="k">this</span><span class="p">.</span><span class="nx">_check</span><span class="p">(</span><span class="k">this</span><span class="p">.</span><span class="nx">listeners</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>
  <span class="p">};</span>

  <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">exports</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="p">(</span><span class="k">typeof</span> <span class="nx">module</span> <span class="o">!==</span> <span class="s1">&#39;undefined&#39;</span> <span class="o">&amp;&amp;</span> <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span><span class="p">)</span> <span class="p">{</span>
      <span class="nx">module</span><span class="p">.</span><span class="nx">exports</span> <span class="o">=</span> <span class="nx">Pather</span><span class="p">;</span>
    <span class="p">}</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="nx">win</span><span class="p">.</span><span class="nx">Pather</span> <span class="o">=</span> <span class="nx">Pather</span><span class="p">;</span>
  <span class="p">}</span>
<span class="p">})(</span><span class="k">this</span><span class="p">,</span> <span class="nb">window</span><span class="p">);</span>

</pre></div>             </td>           </tr>                </tbody>     </table>   </div> </body> </html> 